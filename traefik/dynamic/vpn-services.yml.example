# Traefik routing for media stack services
#
# REMOTE ACCESS (via Cloudflare Tunnel):
# - Jellyfin, Seerr - user-facing services
#
# LOCAL-ONLY (access via NAS_IP:PORT or .lan domains):
# - Sonarr, Radarr, Prowlarr, qBittorrent, Bazarr, Pi-hole
# - These have weak default auth ("Disabled for Local" / "Bypass localhost")
# - Use Seerr for remote media requests instead

http:
  routers:
    jellyfin:
      rule: "Host(`jellyfin.yourdomain.com`)"
      entryPoints:
        - web
      service: jellyfin

    seerr:
      rule: "Host(`seerr.yourdomain.com`)"
      entryPoints:
        - web
      service: seerr

    # Optional: Redirect old jellyseerr domain (backward compat)
    jellyseerr-redirect:
      rule: "Host(`jellyseerr.yourdomain.com`) || Host(`jellyseer.yourdomain.com`)"
      entryPoints:
        - web
      middlewares:
        - jellyseerr-redirect-external
      service: seerr

  middlewares:
    jellyseerr-redirect-external:
      redirectRegex:
        regex: "^https?://jellyseerr?[.](.+)"
        replacement: "https://seerr.${1}"
        permanent: true

  services:
    jellyfin:
      loadBalancer:
        servers:
          - url: "http://172.20.0.4:8096"

    seerr:
      loadBalancer:
        servers:
          - url: "http://172.20.0.8:5055"
